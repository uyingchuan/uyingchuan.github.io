<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="u影川, web前端, blog"><title>JavaScript程序设计 | 小u</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/normalize.css/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/purecss/build/pure-min.min.css"><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/purecss/build/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.jsdelivr.net/npm/jquery/dist/jquery.min.js"></script><link rel="icon" mask="" sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"><script type="text/javascript" src="//cdn.jsdelivr.net/npm/clipboard/dist/clipboard.min.js"></script><script type="text/javascript" src="//cdn.jsdelivr.net/gh/codeseven/toastr/build/toastr.min.js"></script><link rel="stylesheet" href="//cdn.jsdelivr.net/gh/codeseven/toastr/build/toastr.min.css"><meta name="generator" content="Hexo 5.0.0"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">JavaScript程序设计</h1><a id="logo" href="/.">小u</a><p class="description">u影川的小屋</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/tags/"><i class="fa fa-tag"> 标签</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">JavaScript程序设计</h1><div class="post-meta">2020-09-15<span> | </span><span class="category"><a href="/categories/tech-notes/">tech-notes</a></span></div><div class="clear"><div class="toc-article" id="toc"><div class="toc-title">文章目录</div><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80-%E8%AE%BE%E8%AE%A1%E5%8E%9F%E5%88%99"><span class="toc-text">一 设计原则</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E5%8D%95%E4%B8%80%E8%81%8C%E8%B4%A3%E5%8E%9F%E5%88%99%EF%BC%88SRP%EF%BC%89"><span class="toc-text">1 单一职责原则（SRP）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E6%9C%80%E5%B0%91%E7%9F%A5%E8%AF%86%E5%8E%9F%E5%88%99%EF%BC%88LKP%EF%BC%89"><span class="toc-text">2 最少知识原则（LKP）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E5%BC%80%E6%94%BE-%E5%B0%81%E9%97%AD%E5%8E%9F%E5%88%99%EF%BC%88OCP%EF%BC%89"><span class="toc-text">3 开放-封闭原则（OCP）</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C-%E7%BC%96%E7%A8%8B%E6%8A%80%E5%B7%A7"><span class="toc-text">二 编程技巧</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E7%BC%96%E7%A8%8B"><span class="toc-text">1 面向对象编程</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-1-%E6%8A%BD%E8%B1%A1%E7%B1%BB"><span class="toc-text">1.1 抽象类</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-2-%E6%8E%A5%E5%8F%A3"><span class="toc-text">1.2 接口</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E4%BB%A3%E7%A0%81%E9%87%8D%E6%9E%84"><span class="toc-text">2 代码重构</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#2-1-%E6%8F%90%E7%82%BC%E4%BB%A3%E7%A0%81"><span class="toc-text">2.1 提炼代码</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-2-%E5%90%88%E5%B9%B6%E9%87%8D%E5%A4%8D%E6%88%96%E8%BF%87%E9%95%BF%E7%9A%84%E6%9D%A1%E4%BB%B6%E5%88%A4%E6%96%AD%E8%AF%AD%E5%8F%A5"><span class="toc-text">2.2 合并重复或过长的条件判断语句</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-3-%E5%90%88%E7%90%86%E5%BE%AA%E7%8E%AF"><span class="toc-text">2.3 合理循环</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-4-%E7%94%A8%E5%87%BD%E6%95%B0%E9%80%80%E5%87%BA%E6%9D%A5%E4%BB%A3%E6%9B%BF%E5%B5%8C%E5%A5%97%E6%9D%A1%E4%BB%B6%E5%88%86%E6%94%AF"><span class="toc-text">2.4 用函数退出来代替嵌套条件分支</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-5-%E5%90%88%E7%90%86%E5%88%A9%E7%94%A8%E9%93%BE%E5%BC%8F%E8%B0%83%E7%94%A8"><span class="toc-text">2.5 合理利用链式调用</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%89-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F"><span class="toc-text">三 设计模式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F"><span class="toc-text">什么是设计模式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F"><span class="toc-text">1 单例模式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E7%AD%96%E7%95%A5%E6%A8%A1%E5%BC%8F"><span class="toc-text">2 策略模式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E4%BB%A3%E7%90%86%E6%A8%A1%E5%BC%8F"><span class="toc-text">3 代理模式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-%E8%BF%AD%E4%BB%A3%E5%99%A8%E6%A8%A1%E5%BC%8F"><span class="toc-text">4 迭代器模式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-%E5%8F%91%E5%B8%83-%E8%AE%A2%E9%98%85%E6%A8%A1%E5%BC%8F"><span class="toc-text">5 发布-订阅模式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-%E5%91%BD%E4%BB%A4%E6%A8%A1%E5%BC%8F"><span class="toc-text">6 命令模式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-%E7%BB%84%E5%90%88%E6%A8%A1%E5%BC%8F"><span class="toc-text">7 组合模式</span></a></li></ol></li></ol></div></div><div class="post-content"><p>程序设计是给出解决特定问题程序的过程，应当包括分析问题（明确需求）、设计（确定数据结构及算法）、编码（实现具体功能）、调试等不同阶段。<br>本文主要记录 JS 程序设计的设计原则、编程技巧与设计模式。</p>
<a id="more"></a>

<p>文章学自 <a target="_blank" rel="noopener" href="https://www.cnblogs.com/imwtr/p/9451129.html">博客园博客</a> &amp; <a target="_blank" rel="noopener" href="https://www.jianshu.com/p/c5fe9353ba8a">简书博客</a> &amp; <a target="_blank" rel="noopener" href="http://www.alloyteam.com/2012/10/common-javascript-design-patterns/">AlloyTeam</a>，略长。</p>
<div style="height:50px;"></div>

<h3 id="一-设计原则"><a href="#一-设计原则" class="headerlink" title="一 设计原则"></a>一 设计原则</h3><h4 id="1-单一职责原则（SRP）"><a href="#1-单一职责原则（SRP）" class="headerlink" title="1 单一职责原则（SRP）"></a>1 单一职责原则（SRP）</h4><p>一个对象或方法只做一件事。如果一个方法承担了过多的职责，那么在需求的变迁过程中，需要改写这个方法的可能性就会非常大。<br>所以应该将对象或方法划分为较小的粒度。</p>
<h4 id="2-最少知识原则（LKP）"><a href="#2-最少知识原则（LKP）" class="headerlink" title="2 最少知识原则（LKP）"></a>2 最少知识原则（LKP）</h4><p>一个软件实体应当尽可能少的与其他实体发生交互作用，软件实体包括：对象、类、模块、系统、变量、函数等。</p>
<ul>
<li>尽可能少的减少对象之间的交互，如果两个对象之间没必要直接通信，可以引入一个第三者对象来承担两个对象间的通信；</li>
<li>当一个对象必须要引用另一个对象时，让对象只暴露必要的接口，让对象之间的联系限制在最小的范围内。</li>
</ul>
<h4 id="3-开放-封闭原则（OCP）"><a href="#3-开放-封闭原则（OCP）" class="headerlink" title="3 开放-封闭原则（OCP）"></a>3 开放-封闭原则（OCP）</h4><p>软件实体应该是可扩展的，但不可修改。当需要修改一个程序的功能或者给这个程序增加新的功能时，可以使用增加代码的方式，而不是修改代码的方式。</p>
<ul>
<li>利用多态性（把做什么和谁去做分离开来），找出程序中将要发生改变的地方，将这些变化封装起来；</li>
<li>在不可避免的情况下，尽量修改相对容易修改的地方。</li>
</ul>
<div style="height:50px;"></div>

<h3 id="二-编程技巧"><a href="#二-编程技巧" class="headerlink" title="二 编程技巧"></a>二 编程技巧</h3><h4 id="1-面向对象编程"><a href="#1-面向对象编程" class="headerlink" title="1 面向对象编程"></a>1 面向对象编程</h4><p>面向对象编程同面向接口编程，将关注点从对象的类型上转移到对象的行为上，针对对象的超类型的抽象方法编程。</p>
<h5 id="1-1-抽象类"><a href="#1-1-抽象类" class="headerlink" title="1.1 抽象类"></a>1.1 抽象类</h5><p>当泡茶和泡咖啡都有将原料倒入水中的操作时，我们可以将泡茶和泡咖啡向上转型为泡饮料（体现了对象的多态性）。</p>
<p>我们可以在泡饮料的类中写一个将原料倒入水中的抽象方法，同时让从泡饮料继承来的泡茶和泡咖啡的子类重写将原料倒入水中的方法。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ts</span></span><br><span class="line"><span class="keyword">abstract</span> <span class="keyword">class</span> Beverage &#123;</span><br><span class="line">    <span class="keyword">abstract</span> operation():<span class="built_in">void</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> Tea <span class="keyword">extends</span> Beverage &#123;</span><br><span class="line">    operation() &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;将茶包倒入水中&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> Coffee <span class="keyword">extends</span> Beverage &#123;</span><br><span class="line">    operation() &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;将咖啡倒入水中&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="1-2-接口"><a href="#1-2-接口" class="headerlink" title="1.2 接口"></a>1.2 接口</h5><p>接口（Interfaces）是一个很重要的概念，它是对行为的抽象。这里可以将泡饮料抽象为一个接口</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ts</span></span><br><span class="line"><span class="keyword">interface</span> Beverage &#123;</span><br><span class="line">  operation: <span class="built_in">Function</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> Tea <span class="keyword">implements</span> Beverage &#123;</span><br><span class="line">  operation() &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;将茶包倒入水中&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> Coffee <span class="keyword">implements</span> Beverage &#123;</span><br><span class="line">  operation() &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;将咖啡倒入水中&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="2-代码重构"><a href="#2-代码重构" class="headerlink" title="2 代码重构"></a>2 代码重构</h4><h5 id="2-1-提炼代码"><a href="#2-1-提炼代码" class="headerlink" title="2.1 提炼代码"></a>2.1 提炼代码</h5><p>如果函数中有一大堆代码可以被独立出来，最好将这段代码放入另一个独立的函数中。</p>
<p>例子：页面加载完成后既要创建一个圆形，又要打印一些页面的版权信息<br>做法：将创建圆形和打印版权信息分离开来</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">window</span>.onload = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  createCircle()</span><br><span class="line">  log()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createCircle</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> canvas = <span class="built_in">document</span>.querySelector(<span class="string">&#x27;canvas&#x27;</span>)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (canvas.getContext) &#123;</span><br><span class="line">    <span class="keyword">const</span> ctx = canvas.getContext(<span class="string">&#x27;2d&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    ctx.fillStyle = <span class="string">&#x27;red&#x27;</span></span><br><span class="line">    ctx.arc(<span class="number">20</span>, <span class="number">20</span>, <span class="number">20</span>, <span class="number">0</span>, <span class="number">2</span> * <span class="built_in">Math</span>.PI)</span><br><span class="line">    ctx.fill()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">log</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;版权所属&#x27;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="2-2-合并重复或过长的条件判断语句"><a href="#2-2-合并重复或过长的条件判断语句" class="headerlink" title="2.2 合并重复或过长的条件判断语句"></a>2.2 合并重复或过长的条件判断语句</h5><p>如果一个条件判断语句在多处重复使用，便将代码封装在一个独立的函数中。</p>
<h5 id="2-3-合理循环"><a href="#2-3-合理循环" class="headerlink" title="2.3 合理循环"></a>2.3 合理循环</h5><p>如果有些语句是做些一些重复的事情，可以将这些工作放在数组中进行循环。</p>
<h5 id="2-4-用函数退出来代替嵌套条件分支"><a href="#2-4-用函数退出来代替嵌套条件分支" class="headerlink" title="2.4 用函数退出来代替嵌套条件分支"></a>2.4 用函数退出来代替嵌套条件分支</h5><p>当条件嵌套太多层时，可以将这些条件尽可能地抽离成一个层级的条件分支，在进入一些条件分支时，可以让函数立即退出。</p>
<h5 id="2-5-合理利用链式调用"><a href="#2-5-合理利用链式调用" class="headerlink" title="2.5 合理利用链式调用"></a>2.5 合理利用链式调用</h5><p>链式调用并不方便调试，所以尽量避免过分应用。</p>
<div style="height:50px;"></div>

<h3 id="三-设计模式"><a href="#三-设计模式" class="headerlink" title="三 设计模式"></a>三 设计模式</h3><p>在程序设计中有很多实用的设计模式，其中大部分语言的实现都是基于 “类”。<br>而在 JavaScript 中并没有类这种概念(ES6 中的类实际只是语法糖)，JS 中的函数属于一等对象，在 JS 中定义一个对象非常简单 (let obj = {})，而基于 JS 中的闭包与弱类型等特性，在实现一些设计模式的方式上与众不同。</p>
<h4 id="什么是设计模式"><a href="#什么是设计模式" class="headerlink" title="什么是设计模式"></a>什么是设计模式</h4><p>《JavaScript 设计模式与实践》一书中的解释</p>
<p style="border:1px solid #eee;text-indent:30px;">
假设有一个空房间，我们要日复一日地往里 面放一些东西。最简单的办法当然是把这些东西 直接扔进去，但是时间久了，就会发现很难从这 个房子里找到自己想要的东西，要调整某几样东 西的位置也不容易。所以在房间里做一些柜子也 许是个更好的选择，虽然柜子会增加我们的成 本，但它可以在维护阶段为我们带来好处。使用 这些柜子存放东西的规则，或许就是一种模式 
</p>

<p>学习设计模式，有助于写出可复用和可维护性高的程序<br>设计模式的原则是“找出程序中变化的地方，并将变化封装起来”，它的关键是意图，而不是结构。<br>不过要注意，使用不当的话可能会事倍功半</p>
<ul>
<li><a href="#singleton">单例模式</a></li>
<li><a href="#strategy">策略模式</a></li>
<li><a href="#proxy">代理模式</a></li>
<li><a href="#iterator">迭代器模式</a></li>
<li><a href="#release">发布-订阅模式</a></li>
<li><a href="#command">命令模式</a></li>
</ul>
<div id="singleton" style="height:30px;"></div>

<h4 id="1-单例模式"><a href="#1-单例模式" class="headerlink" title="1 单例模式"></a>1 单例模式</h4><p>定义：保证一个类仅有一个实例，并提供一个访问它的全局访问点</p>
<p>核心：确保只有一个实例，并提供全局访问</p>
<p>实现：<br>假设要设置一个管理员，多次调用也仅设置一次，我们可以使用闭包缓存一个内部变量来实现这个单例</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SetManager</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(name) &#123;</span><br><span class="line">    <span class="built_in">this</span>.manager = name</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  getName() &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="built_in">this</span>.manager)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> SingletonSetManager = (<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> manager = <span class="literal">null</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params">name</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!manager) &#123;</span><br><span class="line">      manager = <span class="keyword">new</span> SetManger(name)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> manager</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)()</span><br><span class="line"></span><br><span class="line">SingletonSetManager(<span class="string">&#x27;Bob&#x27;</span>).getName() <span class="comment">// Bob</span></span><br><span class="line">SingletonSetManager(<span class="string">&#x27;Tom&#x27;</span>).getName() <span class="comment">// Bob</span></span><br><span class="line">SingletonSetManager(<span class="string">&#x27;Jack&#x27;</span>).getName() <span class="comment">// Bob</span></span><br></pre></td></tr></table></figure>

<p>这是比较简单的做法，不具有通用的能力，我们可以改写一下代码，使得具备通用性</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 提取出通用的单例</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getSingleton</span>(<span class="params">fn</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> instance = <span class="literal">null</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!instance) &#123;</span><br><span class="line">      instance = fn.apply(<span class="built_in">this</span>, <span class="built_in">arguments</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> instance</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取单例</span></span><br><span class="line"><span class="keyword">const</span> managerSingleton = getSingleton(<span class="function"><span class="keyword">function</span> (<span class="params">name</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> manager = <span class="keyword">new</span> SetManager(name)</span><br><span class="line">  <span class="keyword">return</span> manager</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">managerSingleton(<span class="string">&#x27;Tom&#x27;</span>).getName() <span class="comment">// Tom</span></span><br><span class="line">managerSingleton(<span class="string">&#x27;Jack&#x27;</span>).getName() <span class="comment">// Tom</span></span><br><span class="line">managerSingleton(<span class="string">&#x27;Bob&#x27;</span>).getName() <span class="comment">// Tom</span></span><br></pre></td></tr></table></figure>

<p>这时我们就可以使用<code>getSingleton</code>方法任意的获取某个类的单例。</p>
<div id="strategy" style="height:30px;"></div>

<h4 id="2-策略模式"><a href="#2-策略模式" class="headerlink" title="2 策略模式"></a>2 策略模式</h4><p>定义：定义一系列的算法，把他们一个一个的封装起来，并且使他们可以互相替换。</p>
<p>核心：将算法的使用和算法的实现分离开来<br>一个基于策略模式的程序至少由两部分组成：<br>第一个部分是一组策略类，策略类封装了具体的算法，并负责具体的计算过程；<br>第二个部分是环境类 Context，Context 接受客户的请求，随后把请求委托给某一个策略类，要做到这一点，说明 Context 中要维持对某个策略类对象的引用</p>
<p>实现：<br>策略模式可以用于组合一系列算法，也可用于组合一系列业务规则<br>假设需要通过成绩等级来计算学生的最终得分，每个成绩等级有对应的加权值。我们可以利用对象字面量的形式来直接定义这个组策略。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 加权映射关系</span></span><br><span class="line"><span class="keyword">const</span> levelMap = &#123;</span><br><span class="line">  s: <span class="number">10</span>,</span><br><span class="line">  A: <span class="number">8</span>,</span><br><span class="line">  B: <span class="number">6</span>,</span><br><span class="line">  C: <span class="number">4</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 组策略</span></span><br><span class="line"><span class="keyword">const</span> scoreLevel = &#123;</span><br><span class="line">  basicScore: <span class="number">80</span>,</span><br><span class="line"></span><br><span class="line">  S: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.basicScore + levelMap[<span class="string">&#x27;S&#x27;</span>]</span><br><span class="line">  &#125;,</span><br><span class="line">  A: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.basicScore + levelMap[<span class="string">&#x27;A&#x27;</span>]</span><br><span class="line">  &#125;,</span><br><span class="line">  B: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.basicScore + levelMap[<span class="string">&#x27;B&#x27;</span>]</span><br><span class="line">  &#125;,</span><br><span class="line">  C: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.basicScore + levelMap[<span class="string">&#x27;C&#x27;</span>]</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 调用</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getScore</span>(<span class="params">level</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> scoreLevel[level] ? scoreLevel[level]() : <span class="number">0</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(getScore(<span class="string">&#x27;S&#x27;</span>), getScore(<span class="string">&#x27;A&#x27;</span>), getScore(<span class="string">&#x27;B&#x27;</span>), getScore(<span class="string">&#x27;C&#x27;</span>), getScore(<span class="string">&#x27;D&#x27;</span>)) <span class="comment">// 90, 88, 86, 84, 0</span></span><br></pre></td></tr></table></figure>

<p>在组合业务规则方面，比较经典的是表单的验证方法。这里列出比较关键的部分。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 错误提示</span></span><br><span class="line"><span class="keyword">const</span> errorMessages = &#123;</span><br><span class="line">  <span class="keyword">default</span>: <span class="string">&#x27;输入数据格式不正确&#x27;</span>,</span><br><span class="line">  minLength: <span class="string">&#x27;输入数据长度不够&#x27;</span>,</span><br><span class="line">  isNumber: <span class="string">&#x27;请输入数字&#x27;</span>,</span><br><span class="line">  required: <span class="string">&#x27;内容不能为空&#x27;</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 规则集</span></span><br><span class="line"><span class="keyword">const</span> rules = &#123;</span><br><span class="line">  minLength: <span class="function"><span class="keyword">function</span> (<span class="params">value, length, errorMessage</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (value.length &lt; length) &#123;</span><br><span class="line">      <span class="keyword">return</span> errorMessage || errorMessages[<span class="string">&#x27;minLength&#x27;</span>]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  isNumber: <span class="function"><span class="keyword">function</span> (<span class="params">value, errorMessage</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="regexp">/\d+/</span>.test(value)) &#123;</span><br><span class="line">      <span class="keyword">return</span> errorMessage || errorMessages[<span class="string">&#x27;isNumber&#x27;</span>]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  required: <span class="function"><span class="keyword">function</span> (<span class="params">value, errorMessage</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (value === <span class="string">&#x27;&#x27;</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> errorMessage || errorMessages[<span class="string">&#x27;required&#x27;</span>]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 校验器</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Validator</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>() &#123;</span><br><span class="line">    <span class="built_in">this</span>.items = []</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 添加校验规则</span></span><br><span class="line">  add(value, rule, errorMessage) &#123;</span><br><span class="line">    <span class="keyword">const</span> arg = [value]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (rule.indexOf(<span class="string">&#x27;minLength&#x27;</span>) !== <span class="number">-1</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> temp = rule.split(<span class="string">&#x27;:&#x27;</span>)</span><br><span class="line">      arg.push(temp[<span class="number">1</span>])</span><br><span class="line">      rule = temp[<span class="number">0</span>]</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    arg.push(errorMessage)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">this</span>.items.push(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="comment">// 进行校验</span></span><br><span class="line">      <span class="keyword">return</span> rules[rule].apply(<span class="built_in">this</span>, arg)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  start() &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="built_in">this</span>.items.length; i++) &#123;</span><br><span class="line">      <span class="keyword">const</span> ret = <span class="built_in">this</span>.items[i]()</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (ret) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(ret)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 测试数据</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">testTel</span>(<span class="params">val</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> val</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> validate = <span class="keyword">new</span> Validator()</span><br><span class="line"></span><br><span class="line">validate.add(testTel(<span class="string">&#x27;abc&#x27;</span>), <span class="string">&#x27;isNumber&#x27;</span>, <span class="string">&#x27;只能是数字&#x27;</span>) <span class="comment">// 只能是数字</span></span><br><span class="line">validate.add(testTel(<span class="string">&#x27;&#x27;</span>), <span class="string">&#x27;required&#x27;</span>) <span class="comment">// 内容不能为空</span></span><br><span class="line">validate.add(testTel(<span class="string">&#x27;123&#x27;</span>), <span class="string">&#x27;minLength: 5&#x27;</span>, <span class="string">&#x27;至少5位&#x27;</span>) <span class="comment">// 至少5位</span></span><br><span class="line">validate.add(testTel(<span class="string">&#x27;12345&#x27;</span>), <span class="string">&#x27;minLength: 5&#x27;</span>, <span class="string">&#x27;至少5位&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> ret = validate.start()</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(ret)</span><br></pre></td></tr></table></figure>

<p>优缺点：<br>优点：可以有效的避免多重条件语句，将一系列方法封装起来也更直观，利于维护；<br>缺点：往往策略集会比较多，我么需要事先了解定义好的所有情况。</p>
<div id="proxy" style="height:30px;"></div>

<h4 id="3-代理模式"><a href="#3-代理模式" class="headerlink" title="3 代理模式"></a>3 代理模式</h4><p>定义：为一个对象提供一个代用品或占位符，以便控制对他的访问</p>
<p>核心：当客户不方便直接访问一个对象或者不满足要求时，提供一个替身对象来控制对这个对象的访问，客户实际上访问的是替身对象。<br>替身对象对请求做出一些处理后，再把请求转交给本体对象<br>代理和本体的接口具有一致性，本体定义了关键功能，而代理是提供或拒绝对它的访问，或者在访问本体之前做一些额外的事情</p>
<p>实现：<br>代理模式有三种：保护代理、虚拟代理、缓存代理</p>
<hr>

<p>保护代理主要实现了访问主体的限制行为，以过滤字符作为简单的例子</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 主体 发送信息</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sendMessage</span>(<span class="params">msg</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(msg)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 代理，对消息进行过滤</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">proxySendMessage</span>(<span class="params">msg</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 无消息则返回</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> msg === <span class="string">&#x27;undefined&#x27;</span>) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;deny&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 有消息则进行过滤</span></span><br><span class="line">  msg = (<span class="string">&#x27;&#x27;</span> + msg).replace(<span class="regexp">/s\s*b/gi</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line"></span><br><span class="line">  sendMessage(msg)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> str = <span class="string">&#x27;sad sbS B s b SB&#x27;</span></span><br><span class="line">sendMessage(str) <span class="comment">// sad sbS B s b SB</span></span><br><span class="line">proxySendMessage(str) <span class="comment">// sad</span></span><br><span class="line">proxySendMessage() <span class="comment">// deny</span></span><br></pre></td></tr></table></figure>

<p>他的意图很明显，在访问主体之前进行控制，没有消息的时候直接在代理中返回了，拒绝访问主体，这是数据保护代理的模式<br>有消息的时候对消息中的敏感字符进行了处理，这属于虚拟代理的模式</p>
<hr>

<p>虚拟代理在控制对主体的访问时，加入了一些额外的操作<br>在滚动事件触发的时候，也许不需要频繁触发，我们可以引入函数节流，这是一种虚拟代理的实现</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 函数节流，对于执行频率的函数采取一段时间内只执行一次的方法</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">throttle</span>(<span class="params">handle, wait</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> last = <span class="number">0</span></span><br><span class="line">  <span class="keyword">return</span> <span class="function">(<span class="params">...rest</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> now = <span class="keyword">new</span> <span class="built_in">Date</span>().getTime()</span><br><span class="line">    <span class="comment">// 当距离上次执行处理器 handle 的时间间隔超过了wait时，才可以再次执行处理器</span></span><br><span class="line">    <span class="keyword">if</span> (now - last &gt; wait) &#123;</span><br><span class="line">      handle(...rest)</span><br><span class="line">      last = now</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> count = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 主体</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">scrollHandle</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(e.type, ++count)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 代理</span></span><br><span class="line"><span class="keyword">const</span> proxyScrollHandle = (<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> throttle(scrollHandle, <span class="number">500</span>)</span><br><span class="line">&#125;)()</span><br><span class="line"></span><br><span class="line"><span class="built_in">window</span>.onscroll = proxyScrollHandle</span><br></pre></td></tr></table></figure>

<hr>

<p>缓存代理可以为一些开销大的运算结果提供暂时的缓存，提升效率<br>举个例子，缓存加法操作</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 主体</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params">...rest</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> arg = [...rest]</span><br><span class="line">  <span class="keyword">return</span> arg.reduce(<span class="function">(<span class="params">a, b</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> a + b</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 代理</span></span><br><span class="line"><span class="keyword">const</span> proxyAdd = (<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> cache = []</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params">...rest</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> arg = [...rest].join(<span class="string">&#x27;,&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 如果缓存过，则返回缓存中的结果</span></span><br><span class="line">    <span class="keyword">if</span> (cache[arg]) &#123;</span><br><span class="line">      <span class="keyword">return</span> cache[arg]</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> add(...rest)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)()</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(</span><br><span class="line">  add(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>),</span><br><span class="line">  add(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>),</span><br><span class="line"></span><br><span class="line">  proxyAdd(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>),</span><br><span class="line">  proxyAdd(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>)</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<div id="iterator" style="height:30px;"></div>

<h4 id="4-迭代器模式"><a href="#4-迭代器模式" class="headerlink" title="4 迭代器模式"></a>4 迭代器模式</h4><p>定义：迭代器模式是指提供一种方法顺序访问一个聚合对象中的各个元素，而又不需要暴露该对象的内部表示</p>
<p>核心：在使用迭代器模式后，即使不关心对象的内部构造，也可以按顺序访问其中的每个元素</p>
<p>实现：js 中数组的 map、forEach 已经内置了迭代器</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">;[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>].forEach(<span class="function"><span class="keyword">function</span> (<span class="params">item, index, arr</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(item, index, arr)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>不过对于对象的遍历，往往不能与数组一样使用同样的方法遍历<br>我们可以封装一下</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">each</span>(<span class="params">obj, cb</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> value = <span class="literal">null</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">Array</span>.isArray(obj)) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; obj.length; ++i) &#123;</span><br><span class="line">      value = cb.call(obj[i], i, obj[i])</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i <span class="keyword">in</span> obj) &#123;</span><br><span class="line">      value = cb.call(obj[i], i, obj[i])</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">each([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], <span class="function"><span class="keyword">function</span> (<span class="params">index, value</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(index, value)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">each(&#123; <span class="attr">a</span>: <span class="number">1</span>, <span class="attr">b</span>: <span class="number">2</span>, <span class="attr">c</span>: <span class="number">3</span> &#125;, <span class="function"><span class="keyword">function</span> (<span class="params">index, value</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(index, value)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// 0 1</span></span><br><span class="line"><span class="comment">// 1 2</span></span><br><span class="line"><span class="comment">// 2 3</span></span><br><span class="line"><span class="comment">// a 1</span></span><br><span class="line"><span class="comment">// b 2</span></span><br><span class="line"><span class="comment">// c 3</span></span><br></pre></td></tr></table></figure>

<div id="release" style="height:30px;"></div>

<h4 id="5-发布-订阅模式"><a href="#5-发布-订阅模式" class="headerlink" title="5 发布-订阅模式"></a>5 发布-订阅模式</h4><p>定义：也叫做观察者模式，定义了对象间的一种一对多的依赖关系，当一个状态发生改变时，所有依赖于他的对象都将得到通知</p>
<p>核心：取代对象之间硬编码的通知机制，一个对象不在显式的调用另一个对象的某个接口。<br>与传统的发布-订阅模式实现方式（将订阅者本身当成引用传入发布者）不同，在 js 中通常使用注册回调函数的形式来订阅。</p>
<p>实现：js 中的事件就是经典的发布-订阅模式的实现</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 订阅</span></span><br><span class="line"><span class="built_in">document</span>.body.addEventListener(</span><br><span class="line">  <span class="string">&#x27;click&#x27;</span>,</span><br><span class="line">  <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;click1&#x27;</span>)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="literal">false</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="built_in">document</span>.body.addEventListener(</span><br><span class="line">  <span class="string">&#x27;click&#x27;</span>,</span><br><span class="line">  <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;click2&#x27;</span>)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="literal">false</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 发布</span></span><br><span class="line"><span class="built_in">document</span>.body.click() <span class="comment">// click1, click2</span></span><br></pre></td></tr></table></figure>

<p>优缺点：<br>优点：一为时间上的解耦，二为对象之间的解耦。可以用在异步编程和 MVC 框架中<br>缺点：创建订阅者本身要消耗一定的时间和内存，订阅的处理函数不一定会被执行，驻留内存有性能开销。<br>弱化了对象之间的联系，复杂的情况下可能会导致程序难以跟踪维护和理解。</p>
<div id="command" style="height:30px;"></div>

<h4 id="6-命令模式"><a href="#6-命令模式" class="headerlink" title="6 命令模式"></a>6 命令模式</h4><p>定义：用一种松耦合的方式来设计程序，使得请求发送者和请求接收者能够消除彼此之间的耦合关系<br>命令（command）指的是一个执行某些特定事情的指令</p>
<p>核心：命令中带有 execute 执行、undo 撤销、redo 重做等相关命令方法，建议显式的指示这些方法名</p>
<p>实现：简单的命令模式实现可以直接使用对象字面量的形式定义一个命令</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> incrementCommand = &#123;</span><br><span class="line">  execute: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// code</span></span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>不过接下来的例子是一个自增命令，提供执行、撤销、重做功能  </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">IncrementCommand</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>() &#123;</span><br><span class="line">    <span class="comment">// 当前值</span></span><br><span class="line">    <span class="built_in">this</span>.value = <span class="number">0</span></span><br><span class="line">    <span class="comment">// 命令栈</span></span><br><span class="line">    <span class="built_in">this</span>.stack = []</span><br><span class="line">    <span class="comment">// 栈指针位置</span></span><br><span class="line">    <span class="built_in">this</span>.stackPosition = <span class="number">-1</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 执行</span></span><br><span class="line">  execute() &#123;</span><br><span class="line">    <span class="built_in">this</span>._clearRedo()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> command = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">this</span>.value += <span class="number">2</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 执行并缓存</span></span><br><span class="line">    command()</span><br><span class="line">    <span class="built_in">this</span>.stack.push(command)</span><br><span class="line">    <span class="built_in">this</span>.stackPosition++</span><br><span class="line"></span><br><span class="line">    <span class="built_in">this</span>.getValue()</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 是否能撤消</span></span><br><span class="line">  canUndo() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.stackPosition &gt;= <span class="number">0</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 是否能恢复</span></span><br><span class="line">  canRedo() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.stackPosition &lt; <span class="built_in">this</span>.stack.length - <span class="number">1</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  undo() &#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="built_in">this</span>.canUndo()) &#123;</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">this</span>.stackPosition--</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> command = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">this</span>.value -= <span class="number">2</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    command()</span><br><span class="line">    <span class="built_in">this</span>.getValue()</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  redo() &#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="built_in">this</span>.canRedo()) &#123;</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 执行栈顶的命令</span></span><br><span class="line">    <span class="built_in">this</span>.stack[++<span class="built_in">this</span>.stackPosition]()</span><br><span class="line">    <span class="built_in">this</span>.getValue()</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 执行时，已撤销的操作不能重做</span></span><br><span class="line">  _clearRedo() &#123;</span><br><span class="line">    <span class="built_in">this</span>.stack = <span class="built_in">this</span>.stack.slice(<span class="number">0</span>, <span class="built_in">this</span>.stackPosition + <span class="number">1</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  getValue() &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="built_in">this</span>.value)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>再实例化进行测试，模拟执行、撤销、重做的操作</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> incrementCommand = <span class="keyword">new</span> IncrementCommand()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 模拟事件触发，执行命令</span></span><br><span class="line"><span class="keyword">const</span> eventTrigger = &#123;</span><br><span class="line">  <span class="comment">// 某个事件的处理中，直接调出命令的处理方法</span></span><br><span class="line">  increment() &#123;</span><br><span class="line">    incrementCommand.execute()</span><br><span class="line">  &#125;,</span><br><span class="line">  incrementUndo() &#123;</span><br><span class="line">    incrementCommand.undo()</span><br><span class="line">  &#125;,</span><br><span class="line">  incrementRedo() &#123;</span><br><span class="line">    incrementCommand.redo()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">eventTrigger.increment()  <span class="comment">// 2</span></span><br><span class="line">eventTrigger.increment()  <span class="comment">// 4</span></span><br><span class="line"></span><br><span class="line">eventTrigger.incrementUndo()  <span class="comment">// 2</span></span><br><span class="line"></span><br><span class="line">eventTrigger.increment()  <span class="comment">// 4</span></span><br><span class="line"></span><br><span class="line">eventTrigger.incrementUndo()  <span class="comment">// 2</span></span><br><span class="line">eventTrigger.incrementUndo()  <span class="comment">// 0</span></span><br><span class="line">eventTrigger.incrementUndo()  <span class="comment">// 无输出</span></span><br><span class="line"></span><br><span class="line">eventTrigger.incrementRedo()  <span class="comment">// 2</span></span><br><span class="line">eventTrigger.incrementRedo()  <span class="comment">// 4</span></span><br><span class="line">eventTrigger.incrementRedo()  <span class="comment">// 无输出</span></span><br><span class="line"></span><br><span class="line">eventTrigger.increment()  <span class="comment">// 4</span></span><br></pre></td></tr></table></figure>

<div id="command" style="height:30px;"></div>

<h4 id="7-组合模式"><a href="#7-组合模式" class="headerlink" title="7 组合模式"></a>7 组合模式</h4><p>定义：使用小的子对象来构建更大的对象，而这些小的子对象本身也许是由更小的‘孙对象’构成的</p>
<p>核心：可以用树形结构来表示这种‘部分-整体’的层次结构，调用组合对象的execute方法，程序会递归调用组合对象下子叶对象的execute方法</p>
<p>但要注意的是，组合模式不是父子关系，它是一种HAS-A（聚合）的关系，将请求委托给它所包含的所有叶对象。基于这种委托，就需要保证组合对象和叶对象拥有相同的接口<br>此外，也要保证一致的方式对待列表中的每个子叶对象，即叶对象属于同一类，不需要做额外的特殊操作</p>
<p>实现：<br>使用组合模式来实现扫描文件夹的文件</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">todo...</span><br></pre></td></tr></table></figure></div><div class="tags"><a href="/tags/Javascript/"><i class="fa fa-tag"></i>Javascript</a></div><div class="post-nav"><a class="pre" href="/2020/09/26/tech-notes/vue/vue-theory/">Vue数据双向绑定的原理及实现</a><a class="next" href="/2020/09/14/tech-notes/vue/vue-slot/">Vue插槽</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="https://uyc.gitee.io"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/personal-notes/">personal-notes</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/tech-notes/">tech-notes</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最新文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2020/10/30/tech-notes/levons/process/">Cloudmusic App（node项目）的上线部署</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/10/18/tech-notes/JavaScript/js-promise/">Promise源码实现</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/09/26/tech-notes/vue/vue-theory/">Vue数据双向绑定的原理及实现</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/09/15/tech-notes/JavaScript/js-design-mode/">JavaScript程序设计</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/09/14/tech-notes/vue/vue-slot/">Vue插槽</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/09/13/tech-notes/vue/vue-lazy-load/">Vue路由懒加载</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/09/06/tech-notes/JavaScript/js-prototype/">继承与原型链</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/09/04/tech-notes/JavaScript/js-debounce/">函数防抖与节流</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/08/28/tech-notes/JavaScript/js-closure/">JavaScript闭包及对象私有属性</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/08/10/tech-notes/cloudmusic/cloudmusic-note/">音乐播放器项目知识点</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2020 <a href="/." rel="nofollow">小u.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.jsdelivr.net/gh/fancyapps/fancybox/dist/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox/dist/jquery.fancybox.min.css"><script type="text/javascript" src="/js/copycode.js" successtext="复制成功!"></script><link rel="stylesheet" type="text/css" href="/css/copycode.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>